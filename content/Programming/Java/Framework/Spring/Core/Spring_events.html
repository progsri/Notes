<h4> <b> Spring Events - @EventListener </b> </h4>
<hr>

<p> 
  Spring lets you to listen to specfic events. This lets the application behave accordingly for known Spring events or we can develop
  a mechanism to act on based on our custom events.
</p>

<!----------------------------------------------------------------------------------------------------------------------------------->
<hr>

<h4> <b> ContextRefreshedEvent </b> </h4>
<p>
   This event is generated when the application context is initialized or refreshed.
</p>
<p>
  When you start the application, the below event is captured as the context is initialized.
</p>
<pre class="language-java line-numbers"><code>
@Component
public class EventHandle{

    @EventListener
    public void handleContextRefresh(ContextRefreshedEvent event) {
        System.out.println("EventHandle :: " + event);
    }
}
</code></pre>
<pre class="language-java line-numbers"><code>
EventHandle :: org.springframework.context.event.ContextRefreshedEvent
[source=org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@c667f46,
started on Wed Mar 11 11:43:10 CDT 2020]
</code></pre>

<!----------------------------------------------------------------------------------------------------------------------------------->
<hr>

<h4> <b> RequestHandledEvent </b> </h4>
<p>
   This event is generated when the a http request is processed and while response is being sent out.
</p>
<pre class="language-java line-numbers"><code>
@Component
public class EventHandle{

       @EventListener
    public void handleContextRefresh(RequestHandledEvent event) {
        System.out.println("EventHandle :: " + event);
    }
}
</code></pre>
<pre class="language-java line-numbers"><code>
EventHandle :: ServletRequestHandledEvent: url=[/test]; client=[0:0:0:0:0:0:0:1]; method=[GET]; servlet=[dispatcherServlet];
session=[null]; user=[null]; time=[1383ms]; status=[OK]
</code></pre>

<!----------------------------------------------------------------------------------------------------------------------------------->
<hr>

<h4> <b class="text-danger"> ContextStartedEvent </b> </h4>

<!----------------------------------------------------------------------------------------------------------------------------------->
<hr>

<h4> <b class="text-danger"> ContextStoppedEvent </b> </h4>

<!----------------------------------------------------------------------------------------------------------------------------------->
<hr>

<h4> <b class="text-danger"> ContextClosedEvent </b> </h4>


<!----------------------------------------------------------------------------------------------------------------------------------->
<hr>

<h4> <b class="text-danger"> ServletRequestHandledEvent </b> </h4>


<!----------------------------------------------------------------------------------------------------------------------------------->
<hr>

<h4> <b> Custom Event </b> </h4>

<p>
    We can also generate custom events from the application.
</p>
<p>
  One usage is, let say we get an exception or http 500 error while making calls to third party. We can then emit a custom event that
  would record the error in a database, the code that records to the database would be in the event listener where you register the 
  event. This is evry useful when you have external jar that emits these events and in your code you can register the events to perform
  the required steps to operate on it..may be you can drop it in a queue or sql engine or make a http call to log it to splunk.
</p>

<p> Create the custom event you want to generate</p>
<pre class="language-java line-numbers"><code>
public class CustomEvent {
}
</code></pre>

<p> Register the custom event </p>
<pre class="language-java line-numbers"><code>
@Component
public class EventHandle{

    @EventListener
    public void custom(CustomEvent event) {
        System.out.println("CustomEvent :: " + event);
    }
}
</code></pre>

<p> 
  when needed emit the event, to emit you need <code> ApplicationEventPublisherAware </code> interface which has the
  <code> publishEvent</code> metho or you can autowire <code> ApplicationEventPublisher </code> 
</p>
<pre class="language-java line-numbers"><code>

// --------------- via interface -----------------------
@Component
public class CustomEventPublisher implements ApplicationEventPublisherAware {

    private ApplicationEventPublisher applicationEventPublisher;

    @Override
    public void setApplicationEventPublisher(ApplicationEventPublisher applicationEventPublisher) {
        this.applicationEventPublisher = applicationEventPublisher;
    }

    public void sendEvent(){
        applicationEventPublisher.publishEvent(new CustomEvent());
    }
}

// ------ via Autowire -----------------

@Component
public class CustomEventPublisher { 

    @Autowired
    private ApplicationEventPublisher applicationEventPublisher;
    
    public void sendEvent(){
        applicationEventPublisher.publishEvent(new CustomEvent());
    }
}

</code></pre>
<pre class="language-sh line-numbers"><code>
CustomEvent :: com.ninjashore.springframework.general.CustomEvent@2e91a487
</code></pre>
<!----------------------------------------------------------------------------------------------------------------------------------->
<hr>
